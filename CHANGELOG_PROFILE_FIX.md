# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –≤ Gateway

## –ü—Ä–æ–±–ª–µ–º–∞
Gateway –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª `last_name` –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è –∏ –≤–æ–∑–≤—Ä–∞—â–∞–ª —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ `/api/auth/me`.

## –†–µ—à–µ–Ω–∏–µ

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `/api/auth/me` (auth.go)
- **–ë—ã–ª–æ**: –í–æ–∑–≤—Ä–∞—â–∞–ª –¥–∞–Ω–Ω—ã–µ –∏–∑ JWT —Ç–æ–∫–µ–Ω–∞ (–∫–µ—à)
- **–°—Ç–∞–ª–æ**: –í—Å–µ–≥–¥–∞ —á–∏—Ç–∞–µ—Ç —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤–∫–ª—é—á–∞—è `last_name`

### 2. –î–æ–±–∞–≤–ª–µ–Ω `/api/auth/profile` (auth.go)
- **–ú–µ—Ç–æ–¥**: `PUT` –∏–ª–∏ `PATCH`
- **–§—É–Ω–∫—Ü–∏—è**: `UpdateProfileHandler`
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–æ–ª—è**:
  - `name` - –∏–º—è
  - `last_name` - —Ñ–∞–º–∏–ª–∏—è ‚úÖ
  - `bio` - –±–∏–æ–≥—Ä–∞—Ñ–∏—è
  - `phone` - —Ç–µ–ª–µ—Ñ–æ–Ω
  - `location` - –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ
  - `profile_visibility` - –≤–∏–¥–∏–º–æ—Å—Ç—å –ø—Ä–æ—Ñ–∏–ª—è
  - `show_phone` - –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω
  - `show_email` - –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å email
  - `allow_messages` - —Ä–∞–∑—Ä–µ—à–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
  - `show_online` - –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å

### 3. –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—è
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ NULL**: –≤—Å–µ –ø–æ–ª—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ (`*string`)
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: —Ç—Ä–µ–±—É–µ—Ç—Å—è JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- **–°–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ**: –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î

### 4. –û–±–Ω–æ–≤–ª–µ–Ω —Ä–æ—É—Ç–µ—Ä (router.go)
–î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç:
```go
authRouter.HandleFunc("/profile", AuthMiddlewareFunc(UpdateProfileHandler)).Methods("PUT", "PATCH", "OPTIONS")
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–º–∏–ª–∏—é
```bash
curl -X PUT http://localhost:80/api/auth/profile \
  -H "Content-Type: application/json" \
  -H "Cookie: auth_token=YOUR_TOKEN" \
  -d '{"last_name": "–ù–æ–≤–∞—è –§–∞–º–∏–ª–∏—è"}'
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
```bash
curl http://localhost:80/api/auth/me \
  -H "Cookie: auth_token=YOUR_TOKEN"
```

## –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è –≤ –ª–æ–≥–∞—Ö –±—É–¥–µ—Ç:
```
üîç Updating profile for user 1: name=<nil>, last_name=–ù–æ–≤–∞—è –§–∞–º–∏–ª–∏—è, bio=<nil>, phone=<nil>, location=<nil>
üîç SQL Query: UPDATE users SET last_name = $1 WHERE id = $2
üîç SQL Args: [–ù–æ–≤–∞—è –§–∞–º–∏–ª–∏—è 1]
‚úÖ Profile updated for user 1
```

–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ `/api/auth/me`:
```
üîç Fetching fresh user data for user_id=1
‚úÖ Fresh user data fetched: id=1, name=–ò–≤–∞–Ω, last_name=–ù–æ–≤–∞—è –§–∞–º–∏–ª–∏—è
```

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã
- `auth.go` - –¥–æ–±–∞–≤–ª–µ–Ω `UpdateProfileHandler`, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω `MeHandler`
- `router.go` - –¥–æ–±–∞–≤–ª–µ–Ω —Ä–æ—É—Ç `/api/auth/profile`
- `README.md` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `PROFILE_UPDATE_EXAMPLE.md` - –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)
