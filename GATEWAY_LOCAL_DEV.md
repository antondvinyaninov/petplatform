# üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Gateway –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

> –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π Frontend –∏ Backend –∫ —É–¥–∞–ª–µ–Ω–Ω–æ–º—É Gateway

---

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Frontend (localhost:3000) ‚Üí Gateway (—É–¥–∞–ª–µ–Ω–Ω—ã–π) ‚Üí Backend (localhost:8000) ‚Üí PostgreSQL
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å Gateway –ª–æ–∫–∞–ª—å–Ω–æ
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—à—å production Gateway —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
- ‚úÖ –ú–æ–∂–µ—à—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ Gateway —Å—Ä–∞–∑—É –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- ‚úÖ WebSocket —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ production Gateway

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Gateway (–Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ)

### 1. –î–æ–±–∞–≤—å `localhost:3000` –≤ CORS

–í Gateway `middleware.go` –¥–æ–±–∞–≤—å –≤ `allowedOrigins`:

```go
allowedOrigins := map[string]bool{
    "http://localhost:3000": true,  // ‚Üê –î–û–ë–ê–í–ò–¢–¨ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
    "http://localhost:4000": true,  // ‚Üê –î–û–ë–ê–í–ò–¢–¨ –¥–ª—è –¥—Ä—É–≥–∏—Ö –ø–æ—Ä—Ç–æ–≤
    "https://my-projects-zooplatforma.crv1ic.easypanel.host": true,
    "https://my-projects-gateway-zp.crv1ic.easypanel.host": true,
}
```

### 2. –ù–∞—Å—Ç—Ä–æ–π Gateway –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É Backend

–í Gateway `.env` (–Ω–∞ Easypanel) –¥–æ–±–∞–≤—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ Backend:

```bash
# –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ Gateway –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ç–≤–æ–π –ª–æ–∫–∞–ª—å–Ω—ã–π Backend
# –ù–æ —ç—Ç–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ç.–∫. Gateway –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ localhost –Ω–∞ —Ç–≤–æ–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ

# –ü–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥—Ä—É–≥–æ–π –ø–æ–¥—Ö–æ–¥:
# Gateway –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –Ω–∞ production Backend –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
# –ù–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ Backend - –¥–µ–ø–ª–æ–π –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å
```

**–ü—Ä–æ–±–ª–µ–º–∞:** Gateway –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ `localhost:8000` –Ω–∞ —Ç–≤–æ–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:

#### –í–∞—Ä–∏–∞–Ω—Ç A: –¢–µ—Å—Ç–æ–≤—ã–π Backend –Ω–∞ Easypanel (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –°–æ–∑–¥–∞–π –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å `my-projects-zooplatforma-dev` –Ω–∞ Easypanel
2. –î–µ–ø–ª–æ–π —Ç—É–¥–∞ —Å–≤–æ–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
3. Gateway –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –Ω–∞ `http://my-projects-zooplatforma-dev:80`

#### –í–∞—Ä–∏–∞–Ω—Ç B: ngrok —Ç—É–Ω–Ω–µ–ª—å (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

1. –£—Å—Ç–∞–Ω–æ–≤–∏ ngrok: `brew install ngrok` (macOS)
2. –ó–∞–ø—É—Å—Ç–∏ —Ç—É–Ω–Ω–µ–ª—å: `ngrok http 8000`
3. –ü–æ–ª—É—á–∏—à—å URL —Ç–∏–ø–∞: `https://abc123.ngrok.io`
4. –í Gateway `.env` —É—Å—Ç–∞–Ω–æ–≤–∏: `MAIN_SERVICE_URL=https://abc123.ngrok.io`
5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ Gateway

#### –í–∞—Ä–∏–∞–Ω—Ç C: –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Frontend –∫ Backend (—Ç–µ–∫—É—â–∏–π)

Frontend ‚Üí Backend –Ω–∞–ø—Ä—è–º—É—é (–º–∏–Ω—É—è Gateway –¥–ª—è API)
Frontend ‚Üí Gateway —Ç–æ–ª—å–∫–æ –¥–ª—è WebSocket

–≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ —Ç–µ—Ä—è–µ—Ç—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è.

---

## üöÄ –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ

### 1. Backend `.env` —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω:

```bash
AUTH_SERVICE_URL=https://my-projects-gateway-zp.crv1ic.easypanel.host
```

Backend –±—É–¥–µ—Ç –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ —É–¥–∞–ª–µ–Ω–Ω–æ–º—É Gateway –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

### 2. Frontend `.env.local` –æ–±–Ω–æ–≤–ª–µ–Ω:

```bash
NEXT_PUBLIC_API_URL=https://my-projects-gateway-zp.crv1ic.easypanel.host
```

Frontend –±—É–¥–µ—Ç –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ —É–¥–∞–ª–µ–Ω–Ω–æ–º—É Gateway.

### 3. –ó–∞–ø—É—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å—ã:

```bash
./run
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:

```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1: Backend
cd backend
go run .

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: Frontend  
cd frontend
npm run dev
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞

### 1. Frontend –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Gateway:

–û—Ç–∫—Ä–æ–π `http://localhost:3000` –∏ –ø—Ä–æ–≤–µ—Ä—å –≤ DevTools ‚Üí Network:
- –ó–∞–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –∏–¥—Ç–∏ –∫ `https://my-projects-gateway-zp.crv1ic.easypanel.host/api/*`
- –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å CORS –æ—à–∏–±–æ–∫

### 2. Backend –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –æ—Ç Gateway:

–í –ª–æ–≥–∞—Ö Backend –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
‚úÖ Using headers from Gateway
‚úÖ User from Gateway: id=1, email=...
```

### 3. WebSocket –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ Gateway:

–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
```
‚úÖ WebSocket connected
```

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### CORS –æ—à–∏–±–∫–∞: `No 'Access-Control-Allow-Origin' header`

**–ü—Ä–∏—á–∏–Ω–∞:** Gateway –Ω–µ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –æ—Ç `localhost:3000`.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤—å `localhost:3000` –≤ `allowedOrigins` –≤ Gateway (—Å–º. –≤—ã—à–µ).

### Gateway –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É Backend

**–ü—Ä–∏—á–∏–Ω–∞:** Gateway –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ `localhost:8000` –Ω–∞ —Ç–≤–æ–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π –í–∞—Ä–∏–∞–Ω—Ç B (ngrok) –∏–ª–∏ –í–∞—Ä–∏–∞–Ω—Ç C (–ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ).

### WebSocket –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** WebSocket —Ç—Ä–µ–±—É–µ—Ç wss:// (HTTPS) –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —É–¥–∞–ª–µ–Ω–Ω–æ–º—É Gateway.

**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Å—å —á—Ç–æ `NEXT_PUBLIC_API_URL` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `https://` (–Ω–µ `http://`).

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π workflow

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ Frontend:

```bash
# Frontend ‚Üí Gateway (—É–¥–∞–ª–µ–Ω–Ω—ã–π) ‚Üí Backend (production)
# –ò–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –≤ Frontend, Backend –Ω–µ —Ç—Ä–æ–≥–∞–µ–º

1. –ó–∞–ø—É—Å—Ç–∏ —Ç–æ–ª—å–∫–æ Frontend: cd frontend && npm run dev
2. –û—Ç–∫—Ä–æ–π http://localhost:3000
3. Frontend –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ production Gateway –∏ Backend
4. –†–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–π –∏ —Ç–µ—Å—Ç–∏—Ä—É–π Frontend
5. –ö–æ–º–º–∏—Ç—å –∏ –ø—É—à–∏—Ç—å
```

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ Backend:

```bash
# Frontend (localhost) ‚Üí Gateway (—É–¥–∞–ª–µ–Ω–Ω—ã–π) ‚Üí Backend (localhost)
# –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ Backend, —Ç–µ—Å—Ç–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω–æ

1. –ó–∞–ø—É—Å—Ç–∏ Backend: cd backend && go run .
2. –ó–∞–ø—É—Å—Ç–∏ Frontend: cd frontend && npm run dev
3. –ù–∞—Å—Ç—Ä–æ–π Gateway –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ç–≤–æ–π Backend (ngrok)
4. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (—Å–º. –í–∞—Ä–∏–∞–Ω—Ç C)
5. –¢–µ—Å—Ç–∏—Ä—É–π –∏–∑–º–µ–Ω–µ–Ω–∏—è
6. –ö–æ–º–º–∏—Ç—å –∏ –ø—É—à–∏—Ç—å
```

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ Gateway:

```bash
# –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ Gateway - –¥–µ–ø–ª–æ–π –Ω–∞ production

1. –í–Ω–µ—Å–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ Gateway —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –ö–æ–º–º–∏—Ç—å –∏ –ø—É—à–∏—Ç—å
3. Easypanel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç Gateway
4. –¢–µ—Å—Ç–∏—Ä—É–π –Ω–∞ http://localhost:3000 (Frontend –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–º—É Gateway)
```

---

## üéØ –ò—Ç–æ–≥–æ

**–¢–µ–∫—É—â–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:**
- ‚úÖ Frontend ‚Üí —É–¥–∞–ª–µ–Ω–Ω—ã–π Gateway
- ‚úÖ Backend ‚Üí —É–¥–∞–ª–µ–Ω–Ω—ã–π Gateway (–¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
- ‚úÖ WebSocket ‚Üí —É–¥–∞–ª–µ–Ω–Ω—ã–π Gateway
- ‚ö†Ô∏è Gateway ‚Üí production Backend (–Ω–µ –ª–æ–∫–∞–ª—å–Ω—ã–π)

**–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ Backend:**
- –ò—Å–ø–æ–ª—å–∑—É–π ngrok —Ç—É–Ω–Ω–µ–ª—å
- –ò–ª–∏ –¥–µ–ø–ª–æ–π –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å
- –ò–ª–∏ –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Frontend ‚Üí Backend (–º–∏–Ω—É—è Gateway)

**–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ Gateway:**
- –î–µ–ø–ª–æ–π –Ω–∞ production
- –¢–µ—Å—Ç–∏—Ä—É–π —Å –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ Frontend

---

**–í–æ–ø—Ä–æ—Å—ã?** –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ Gateway –Ω–∞ Easypanel ‚Üí Projects ‚Üí gateway-zp ‚Üí Logs
